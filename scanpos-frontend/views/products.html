<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Products Management</h2>
        <button class="btn btn-primary" ng-click="addProduct()" ng-show="!showForm">
            <i class="bi bi-plus-circle"></i> Add Product
        </button>
    </div>
    
    <!-- Search Bar -->
    <div class="row mb-3" ng-show="!showForm">
        <div class="col-md-6">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search by name or barcode..." 
                       ng-model="search" 
                       ng-change="debouncedSearch()"
                       ng-keyup="$event.keyCode == 13 && searchProducts()">
                <button class="btn btn-outline-secondary" type="button" ng-click="searchProducts()" ng-disabled="searching">
                    <i class="bi bi-search"></i> <span ng-if="!searching">Search</span><span ng-if="searching">Searching...</span>
                </button>
            </div>
            <small class="text-muted" ng-if="searching">
                <i class="bi bi-hourglass-split"></i> Searching...
            </small>
        </div>
    </div>
    
    <!-- Add/Edit Form -->
    <div class="card mb-4" ng-show="showForm">
        <div class="card-header">
            <h5>{{ editMode ? 'Edit Product' : 'Add New Product' }}</h5>
        </div>
        <div class="card-body">
            <form ng-submit="saveProduct()" name="productForm" novalidate>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Product Name</label>
                        <input type="text" 
                               class="form-control" 
                               ng-model="currentProduct.name" 
                               name="productName"
                               required
                               minlength="3"
                               maxlength="200">
                        <div class="validation-error" ng-show="productForm.productName.$touched && productForm.productName.$error.required">
                            Product name is required
                        </div>
                        <div class="validation-error" ng-show="productForm.productName.$touched && productForm.productName.$error.minlength">
                            Product name must be at least 3 characters
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Barcode</label>
                        <input type="text" 
                               class="form-control" 
                               ng-model="currentProduct.barcode"
                               name="barcode"
                               maxlength="100">
                        <small class="form-text">Optional - Leave empty if not applicable</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Price (₹)</label>
                        <input type="number" 
                               step="0.01" 
                               class="form-control" 
                               ng-model="currentProduct.price"
                               name="price"
                               required
                               min="0.01">
                        <div class="validation-error" ng-show="productForm.price.$touched && productForm.price.$error.required">
                            Price is required
                        </div>
                        <div class="validation-error" ng-show="productForm.price.$touched && productForm.price.$error.min">
                            Price must be greater than 0
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Tax %</label>
                        <input type="number" 
                               step="0.01" 
                               class="form-control" 
                               ng-model="currentProduct.tax_percent"
                               name="taxPercent"
                               min="0"
                               max="100">
                        <div class="validation-error" ng-show="productForm.taxPercent.$touched && (productForm.taxPercent.$error.min || productForm.taxPercent.$error.max)">
                            Tax must be between 0 and 100
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Stock Quantity</label>
                        <input type="number" 
                               class="form-control" 
                               ng-model="currentProduct.stock_qty"
                               name="stockQty"
                               required
                               min="0">
                        <div class="validation-error" ng-show="productForm.stockQty.$touched && productForm.stockQty.$error.required">
                            Stock quantity is required
                        </div>
                        <div class="validation-error" ng-show="productForm.stockQty.$touched && productForm.stockQty.$error.min">
                            Stock cannot be negative
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="isActive" ng-model="currentProduct.is_active">
                        <label class="form-check-label" for="isActive">Active</label>
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" 
                            class="btn btn-success" 
                            ng-class="{'btn-loading': loading}"
                            ng-disabled="productForm.$invalid || loading">
                        <i class="bi bi-check-circle"></i> {{loading ? 'Saving...' : 'Save'}}
                    </button>
                    <button type="button" class="btn btn-secondary" ng-click="cancelForm()" ng-disabled="loading">
                        <i class="bi bi-x-circle"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Products Table -->
    <div class="card" ng-show="!showForm">
        <div class="card-body">
            <!-- Loading State -->
            <div ng-show="loading" class="inline-loader">
                <div class="spinner spinner-md"></div>
                <div class="loading-text">Loading products...</div>
            </div>
            
            <!-- Empty State -->
            <div ng-show="!loading && products.length === 0" class="text-center py-4">
                <i class="bi bi-inbox" style="font-size: 48px; color: #ccc;"></i>
                <p class="text-muted mt-2">No products found</p>
            </div>
            
            <!-- Products Table -->
            <div ng-show="!loading && products.length > 0" class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Barcode</th>
                            <th>Price</th>
                            <th>Tax %</th>
                            <th>Stock</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="product in products">
                            <td>{{ product.name }}</td>
                            <td>{{ product.barcode || '-' }}</td>
                            <td>₹{{ product.price }}</td>
                            <td>{{ product.tax_percent }}%</td>
                            <td>{{ product.stock_qty }}</td>
                            <td>
                                <span class="badge" ng-class="product.is_active ? 'bg-success' : 'bg-secondary'">
                                    {{ product.is_active ? 'Active' : 'Inactive' }}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-warning me-1" ng-click="editProduct(product)">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger" ng-click="deleteProduct(product)">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

